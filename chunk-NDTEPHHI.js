import{a as xt,c as It,d as Ft,f as Pt,j as be,m as At,o as Ot,p as ye,x as Rt}from"./chunk-BE45KCKU.js";import{$ as y,$a as Ct,A as q,Aa as w,C as he,Ca as G,Cb as Et,Da as ie,E as u,Ea as gt,Fb as Dt,Ha as bt,I as re,Ia as F,J as C,Ja as yt,K as M,Ka as k,La as W,Lb as Tt,Ma as g,N as L,Na as vt,Oa as _t,P as ct,R as p,S as I,V as lt,W as ut,Ya as T,Za as Y,_a as wt,a as Te,ca as mt,db as Mt,eb as xe,fb as Ie,ga as S,hb as pe,ia as ft,ib as ge,jb as St,ka as ht,kb as X,lb as Nt,ob as kt,sa as j,ta as B,tb as m,ub as d,va as pt,vb as K,wa as $,wb as P,xa as H,xb as h,y as b,ya as D,za as v}from"./chunk-GEUL6SEO.js";import{a as l,b as _,e as fe}from"./chunk-6MDQTQU3.js";var Fe=0;function fn(){return Fe}function R(n,e){return(...t)=>{try{return Fe=e,n(...t)}finally{Fe=0}}}function hn(n){return!n}function Vt(n){return n}function E(n){return Array.isArray(n)}function Z(n){return(typeof n=="object"||typeof n=="function")&&n!=null}var U=Symbol(),Ne=Symbol(),se=class{predicates;fns=[];constructor(e){this.predicates=e}push(e){this.fns.push(Lt(this.predicates,e))}mergeIn(e){let t=this.predicates?e.fns.map(r=>Lt(this.predicates,r)):e.fns;this.fns.push(...t)}},_e=class extends se{get defaultValue(){return!1}compute(e){return this.fns.some(t=>{let r=t(e);return r&&r!==Ne})}},J=class n extends se{ignore;static ignoreNull(e){return new n(e,t=>t===null)}constructor(e,t){super(e),this.ignore=t}get defaultValue(){return[]}compute(e){return this.fns.reduce((t,r)=>{let i=r(e);return i===void 0||i===Ne?t:E(i)?[...t,...this.ignore?i.filter(o=>!this.ignore(o)):i]:this.ignore&&this.ignore(i)?t:[...t,i]},[])}},Pe=class extends J{constructor(e){super(e,void 0)}},Ae=class extends se{key;get defaultValue(){return this.key.reducer.getInitial()}constructor(e,t){super(e),this.key=t}compute(e){if(this.fns.length===0)return this.key.reducer.getInitial();let t=this.key.reducer.getInitial();for(let r=0;r<this.fns.length;r++){let i=this.fns[r](e);i!==Ne&&(t=this.key.reducer.reduce(t,i))}return t}};function Lt(n,e){return n.length===0?e:t=>{for(let r of n){let i=t.stateOf(r.path),o=m(i.structure.pathKeys).length-r.depth;for(let s=0;s<o;s++)i=i.structure.parent;if(!r.fn(i.context))return Ne}return e(t)}}var Q=class{predicates;hidden;disabledReasons;readonly;syncErrors;syncTreeErrors;asyncErrors;metadata=new Map;constructor(e){this.predicates=e,this.hidden=new _e(e),this.disabledReasons=new Pe(e),this.readonly=new _e(e),this.syncErrors=J.ignoreNull(e),this.syncTreeErrors=J.ignoreNull(e),this.asyncErrors=J.ignoreNull(e)}hasMetadata(e){return this.metadata.has(e)}getMetadataKeys(){return this.metadata.keys()}getMetadata(e){return this.metadata.has(e)||this.metadata.set(e,new Ae(this.predicates,e)),this.metadata.get(e)}mergeIn(e){this.hidden.mergeIn(e.hidden),this.disabledReasons.mergeIn(e.disabledReasons),this.readonly.mergeIn(e.readonly),this.syncErrors.mergeIn(e.syncErrors),this.syncTreeErrors.mergeIn(e.syncTreeErrors),this.asyncErrors.mergeIn(e.asyncErrors);for(let t of e.getMetadataKeys()){let r=e.metadata.get(t);this.getMetadata(t).mergeIn(r)}}},we=class{depth;constructor(e){this.depth=e}build(){return new Ce(this,[],0)}},ee=class n extends we{constructor(e){super(e)}current;all=[];addHiddenRule(e){this.getCurrent().addHiddenRule(e)}addDisabledReasonRule(e){this.getCurrent().addDisabledReasonRule(e)}addReadonlyRule(e){this.getCurrent().addReadonlyRule(e)}addSyncErrorRule(e){this.getCurrent().addSyncErrorRule(e)}addSyncTreeErrorRule(e){this.getCurrent().addSyncTreeErrorRule(e)}addAsyncErrorRule(e){this.getCurrent().addAsyncErrorRule(e)}addMetadataRule(e,t){this.getCurrent().addMetadataRule(e,t)}getChild(e){if(e===U){let t=this.getCurrent().children;t.size>(t.has(U)?1:0)&&(this.current=void 0)}return this.getCurrent().getChild(e)}hasLogic(e){return this===e?!0:this.all.some(({builder:t})=>t.hasLogic(e))}mergeIn(e,t){t?this.all.push({builder:e,predicate:{fn:R(t.fn,this.depth),path:t.path}}):this.all.push({builder:e}),this.current=void 0}getCurrent(){return this.current===void 0&&(this.current=new ae(this.depth),this.all.push({builder:this.current})),this.current}static newRoot(){return new n(0)}},ae=class extends we{logic=new Q([]);children=new Map;constructor(e){super(e)}addHiddenRule(e){this.logic.hidden.push(R(e,this.depth))}addDisabledReasonRule(e){this.logic.disabledReasons.push(R(e,this.depth))}addReadonlyRule(e){this.logic.readonly.push(R(e,this.depth))}addSyncErrorRule(e){this.logic.syncErrors.push(R(e,this.depth))}addSyncTreeErrorRule(e){this.logic.syncTreeErrors.push(R(e,this.depth))}addAsyncErrorRule(e){this.logic.asyncErrors.push(R(e,this.depth))}addMetadataRule(e,t){this.logic.getMetadata(e).push(R(t,this.depth))}getChild(e){return this.children.has(e)||this.children.set(e,new ee(this.depth+1)),this.children.get(e)}hasLogic(e){return this===e}},Ce=class n{builder;predicates;depth;logic;constructor(e,t,r){this.builder=e,this.predicates=t,this.depth=r,this.logic=e?pn(e,t,r):new Q([])}getChild(e){let t=this.builder?Kt(this.builder,e):[];if(t.length===0)return new n(void 0,[],this.depth+1);if(t.length===1){let{builder:r,predicates:i}=t[0];return new n(r,[...this.predicates,...i.map(o=>Re(o,this.depth))],this.depth+1)}else{let r=t.map(({builder:i,predicates:o})=>new n(i,[...this.predicates,...o.map(s=>Re(s,this.depth))],this.depth+1));return new Oe(r)}}hasLogic(e){return this.builder?.hasLogic(e)??!1}},Oe=class n{all;logic;constructor(e){this.all=e,this.logic=new Q([]);for(let t of e)this.logic.mergeIn(t.logic)}getChild(e){return new n(this.all.flatMap(t=>t.getChild(e)))}hasLogic(e){return this.all.some(t=>t.hasLogic(e))}};function Kt(n,e){if(n instanceof ee)return n.all.flatMap(({builder:t,predicate:r})=>{let i=Kt(t,e);return r?i.map(({builder:o,predicates:s})=>({builder:o,predicates:[...s,r]})):i});if(n instanceof ae)return[...e!==U&&n.children.has(U)?[{builder:n.getChild(U),predicates:[]}]:[],...n.children.has(e)?[{builder:n.getChild(e),predicates:[]}]:[]];throw new b(1909,!1)}function pn(n,e,t){let r=new Q(e);if(n instanceof ee){let i=n.all.map(({builder:o,predicate:s})=>new Ce(o,s?[...e,Re(s,t)]:e,t));for(let o of i)r.mergeIn(o.logic)}else if(n instanceof ae)r.mergeIn(n.logic);else throw new b(1909,!1);return r}function Re(n,e){return _(l({},n),{depth:e})}var Ut=Symbol("PATH"),A=class n{keys;parent;keyInParent;root;children=new Map;fieldPathProxy=new Proxy(this,gn);logicBuilder;constructor(e,t,r,i){this.keys=e,this.parent=r,this.keyInParent=i,this.root=t??this,r||(this.logicBuilder=ee.newRoot())}get builder(){return this.logicBuilder?this.logicBuilder:this.parent.builder.getChild(this.keyInParent)}getChild(e){return this.children.has(e)||this.children.set(e,new n([...this.keys,e],this.root,this,e)),this.children.get(e)}mergeIn(e,t){let r=e.compile();this.builder.mergeIn(r.builder,t)}static unwrapFieldPath(e){return e[Ut]}static newRoot(){return new n([],void 0,void 0,void 0)}},gn={get(n,e){return e===Ut?n:n.getChild(e).fieldPathProxy}},ve,oe=new Map,de=class n{schemaFn;constructor(e){this.schemaFn=e}compile(){if(oe.has(this))return oe.get(this);let e=A.newRoot();oe.set(this,e);let t=ve;try{ve=e,this.schemaFn(e.fieldPathProxy)}finally{ve=t}return e}static create(e){return e instanceof n?e:new n(e)}static rootCompile(e){try{return oe.clear(),e===void 0?A.newRoot():e instanceof n?e.compile():new n(e).compile()}finally{oe.clear()}}};function bn(n){return n instanceof de||typeof n=="function"}function We(n){if(ve!==A.unwrapFieldPath(n).root)throw new b(1908,!1)}function le(n,e,t){return We(n),A.unwrapFieldPath(n).builder.addMetadataRule(e,t),e}var V={list(){return{reduce:(n,e)=>e===void 0?n:[...n,e],getInitial:()=>[]}},min(){return{reduce:(n,e)=>n===void 0||e===void 0?n??e:Math.min(n,e),getInitial:()=>{}}},max(){return{reduce:(n,e)=>n===void 0||e===void 0?n??e:Math.max(n,e),getInitial:()=>{}}},or(){return{reduce:(n,e)=>n||e,getInitial:()=>!1}},and(){return{reduce:(n,e)=>n&&e,getInitial:()=>!0}},override:yn};function yn(n){return{reduce:(e,t)=>t,getInitial:()=>n?.()}}var Me=class{reducer;create;brand;constructor(e,t){this.reducer=e,this.create=t}};function x(n){return new Me(n??V.override())}var Ye=x(V.or()),zt=x(V.max()),qt=x(V.min()),$t=x(V.max()),Ht=x(V.min()),Xe=x(V.list());function vn(n){return n.errors().length>0?"invalid":n.pending()?"unknown":"valid"}var Ve=class{node;constructor(e){this.node=e}rawSyncTreeErrors=d(()=>this.shouldSkipValidation()?[]:[...this.node.logicNode.logic.syncTreeErrors.compute(this.node.context),...this.node.structure.parent?.validationState.rawSyncTreeErrors()??[]]);syncErrors=d(()=>this.shouldSkipValidation()?[]:[...this.node.logicNode.logic.syncErrors.compute(this.node.context),...this.syncTreeErrors(),..._n(this.node.submitState.submissionErrors())]);syncValid=d(()=>this.shouldSkipValidation()?!0:this.node.structure.reduceChildren(this.syncErrors().length===0,(e,t)=>t&&e.validationState.syncValid(),hn));syncTreeErrors=d(()=>this.rawSyncTreeErrors().filter(e=>e.fieldTree===this.node.fieldTree));rawAsyncErrors=d(()=>this.shouldSkipValidation()?[]:[...this.node.logicNode.logic.asyncErrors.compute(this.node.context),...this.node.structure.parent?.validationState.rawAsyncErrors()??[]]);asyncErrors=d(()=>this.shouldSkipValidation()?[]:this.rawAsyncErrors().filter(e=>e==="pending"||e.fieldTree===this.node.fieldTree));parseErrors=d(()=>this.node.formFieldBindings().flatMap(e=>e.parseErrors()));errors=d(()=>[...this.parseErrors(),...this.syncErrors(),...this.asyncErrors().filter(e=>e!=="pending")]);errorSummary=d(()=>{let e=this.node.structure.reduceChildren(this.errors(),(t,r)=>[...r,...t.errorSummary()]);return m(()=>e.sort(wn)),e});pending=d(()=>this.node.structure.reduceChildren(this.asyncErrors().includes("pending"),(e,t)=>t||e.validationState.asyncErrors().includes("pending")));status=d(()=>{if(this.shouldSkipValidation())return"valid";let e=vn(this);return this.node.structure.reduceChildren(e,(t,r)=>r==="invalid"||t.validationState.status()==="invalid"?"invalid":r==="unknown"||t.validationState.status()==="unknown"?"unknown":"valid",t=>t==="invalid")});valid=d(()=>this.status()==="valid");invalid=d(()=>this.status()==="invalid");shouldSkipValidation=d(()=>this.node.hidden()||this.node.disabled()||this.node.readonly())};function _n(n){return n===void 0?[]:E(n)?n:[n]}function Ze(n,e){if(E(n))for(let t of n)t.fieldTree??=e;else n&&(n.fieldTree??=e);return n}function jt(n){return n.formField?n.formField.element:n.fieldTree().formFieldBindings().reduce((e,t)=>!e||!t.element?e??t.element:e.compareDocumentPosition(t.element)&Node.DOCUMENT_POSITION_PRECEDING?t.element:e,void 0)}function wn(n,e){let t=jt(n),r=jt(e);return t===r?0:t===void 0||r===void 0?t===void 0?1:-1:t.compareDocumentPosition(r)&Node.DOCUMENT_POSITION_PRECEDING?1:-1}var Le=x(),je=class{node;cache=new WeakMap;constructor(e){this.node=e}resolve(e){if(!this.cache.has(e)){let t=d(()=>{let r=A.unwrapFieldPath(e),i=this.node,o=fn();for(;o>0||!i.structure.logic.hasLogic(r.root.builder);)if(o--,i=i.structure.parent,i===void 0)throw new b(1900,!1);for(let s of r.keys)if(i=i.structure.getChild(s),i===void 0)throw new b(1901,!1);return i.fieldTree});this.cache.set(e,t)}return this.cache.get(e)()}get fieldTree(){return this.node.fieldProxy}get state(){return this.node}get value(){return this.node.structure.value}get key(){return this.node.structure.keyInParent}get pathKeys(){return this.node.structure.pathKeys}index=d(()=>{let e=this.key();if(!E(m(this.node.structure.parent.value)))throw new b(1906,!1);return Number(e)});fieldTreeOf=e=>this.resolve(e);stateOf=e=>this.resolve(e)();valueOf=e=>{let t=this.resolve(e)().value();if(t instanceof Pt)throw new b(1907,!1);return t}},Be=class{node;metadata=new Map;constructor(e){this.node=e;for(let t of this.node.logicNode.logic.getMetadataKeys())if(t.create){let r=this.node.logicNode.logic.getMetadata(t),i=m(()=>re(this.node.structure.injector,()=>t.create(d(()=>r.compute(this.node.context)))));this.metadata.set(t,i)}}get(e){if(this.has(e)&&!this.metadata.has(e)){if(e.create)throw new b(1912,!1);let t=this.node.logicNode.logic.getMetadata(e);this.metadata.set(e,d(()=>t.compute(this.node.context)))}return this.metadata.get(e)}has(e){return this.node.logicNode.logic.hasMetadata(e)}},Cn={get(n,e,t){let r=n(),i=r.structure.getChild(e);if(i!==void 0)return i.fieldTree;let o=m(r.value);if(E(o)){if(e==="length")return r.value().length;if(e===Symbol.iterator)return()=>(r.value(),Array.prototype[Symbol.iterator].apply(r.fieldTree))}if(Z(o)&&e===Symbol.iterator)return function*(){for(let s in t)yield[s,t[s]]}},getOwnPropertyDescriptor(n,e){let t=m(n().value),r=Reflect.getOwnPropertyDescriptor(t,e);return r&&!r.configurable&&(r.configurable=!0),r},ownKeys(n){let e=m(n().value);return typeof e=="object"&&e!==null?Reflect.ownKeys(e):[]}};function Mn(n,e){let t=d(()=>n()[e()]);return t[Te]=n[Te],t.set=r=>{n.update(i=>Sn(i,r,e()))},t.update=r=>{t.set(r(m(t)))},t.asReadonly=()=>t,t}function Sn(n,e,t){if(E(n)){let r=[...n];return r[t]=e,r}else return _(l({},n),{[t]:e})}var Se=class{logic;node;createChildNode;identitySymbol=Symbol();_injector=void 0;get injector(){return this._injector??=L.create({providers:[],parent:this.fieldManager.injector}),this._injector}constructor(e,t,r){this.logic=e,this.node=t,this.createChildNode=r}children(){let e=this.childrenMap();return e===void 0?[]:Array.from(e.byPropertyKey.values()).map(t=>m(t.reader))}getChild(e){let t=e.toString(),r=m(this.childrenMap)?.byPropertyKey.get(t)?.reader;return r||(r=this.createReader(t)),r()}reduceChildren(e,t,r){let i=this.childrenMap();if(!i)return e;let o=e;for(let s of i.byPropertyKey.values()){if(r?.(o))break;o=t(m(s.reader),o)}return o}destroy(){this.injector.destroy()}createKeyInParent(e,t,r){if(e.kind==="root")return Gt;if(t===void 0){let i=r;return d(()=>{if(this.parent.structure.getChild(i)!==this.node)throw new b(1902,!1);return i})}else{let i=r;return d(()=>{let o=this.parent.structure.value();if(!E(o))throw new b(1903,!1);let s=o[i];if(Z(s)&&s.hasOwnProperty(this.parent.structure.identitySymbol)&&s[this.parent.structure.identitySymbol]===t)return i;for(let a=0;a<o.length;a++){let c=o[a];if(Z(c)&&c.hasOwnProperty(this.parent.structure.identitySymbol)&&c[this.parent.structure.identitySymbol]===t)return i=a.toString()}throw new b(1904,!1)})}}createChildrenMap(){return K({source:this.value,computation:(e,t)=>{if(!Z(e))return;let r=t?.value??{byPropertyKey:new Map},i,o=E(e);r!==void 0&&(o?i=kn(r,e,this.identitySymbol):i=En(r,e));for(let s of Object.keys(e)){let a,c=e[s];if(c===void 0){r.byPropertyKey.has(s)&&(i??=l({},r),i.byPropertyKey.delete(s));continue}o&&Z(c)&&!E(c)&&(a=c[this.identitySymbol]??=Symbol(""));let f;a&&(r.byTrackingKey?.has(a)||(i??=l({},r),i.byTrackingKey??=new Map,i.byTrackingKey.set(a,this.createChildNode(s,a,o))),f=(i??r).byTrackingKey.get(a));let N=r.byPropertyKey.get(s);N===void 0?(i??=l({},r),i.byPropertyKey.set(s,{reader:this.createReader(s),node:f??this.createChildNode(s,a,o)})):f&&f!==N.node&&(i??=l({},r),N.node=f)}return i??r}})}createReader(e){return d(()=>this.childrenMap()?.byPropertyKey.get(e)?.node)}},Ke=class extends Se{fieldManager;value;get parent(){}get root(){return this.node}get pathKeys(){return Nn}get keyInParent(){return Gt}childrenMap;constructor(e,t,r,i,o){super(t,e,o),this.fieldManager=r,this.value=i,this.childrenMap=this.createChildrenMap()}},Ue=class extends Se{logic;parent;root;pathKeys;keyInParent;value;childrenMap;get fieldManager(){return this.root.structure.fieldManager}constructor(e,t,r,i,o,s){super(t,e,s),this.logic=t,this.parent=r,this.root=this.parent.structure.root,this.keyInParent=this.createKeyInParent({kind:"child",parent:r,pathNode:void 0,logic:t,initialKeyInParent:o,identityInParent:i,fieldAdapter:void 0},i,o),this.pathKeys=d(()=>[...r.structure.pathKeys(),this.keyInParent()]),this.value=Mn(this.parent.structure.value,this.keyInParent),this.childrenMap=this.createChildrenMap(),this.fieldManager.structures.add(this)}};var Nn=d(()=>[]),Gt=d(()=>{throw new b(1905,!1)});function kn(n,e,t){let r,i=new Set(n.byPropertyKey.keys()),o=new Set(n.byTrackingKey?.keys());for(let s=0;s<e.length;s++){let a=e[s];i.delete(s.toString()),Z(a)&&a.hasOwnProperty(t)&&o.delete(a[t])}if(i.size>0){r??=l({},n);for(let s of i)r.byPropertyKey.delete(s)}if(o.size>0){r??=l({},n);for(let s of o)r.byTrackingKey?.delete(s)}return r}function En(n,e){let t;for(let r of n.byPropertyKey.keys())e.hasOwnProperty(r)||(t??=l({},n),t.byPropertyKey.delete(r));return t}var ze=class{node;selfSubmitting=p(!1);submissionErrors;constructor(e){this.node=e,this.submissionErrors=K({source:this.node.structure.value,computation:()=>[]})}submitting=d(()=>this.selfSubmitting()||(this.node.structure.parent?.submitting()??!1))},ce=class{structure;validationState;metadataState;nodeState;submitState;fieldAdapter;controlValue;_context=void 0;get context(){return this._context??=new je(this)}fieldProxy=new Proxy(()=>this,Cn);pathNode;constructor(e){this.pathNode=e.pathNode,this.fieldAdapter=e.fieldAdapter,this.structure=this.fieldAdapter.createStructure(this,e),this.validationState=this.fieldAdapter.createValidationState(this,e),this.nodeState=this.fieldAdapter.createNodeState(this,e),this.metadataState=new Be(this),this.submitState=new ze(this),this.controlValue=this.controlValueSignal()}focusBoundControl(e){this.getBindingForFocus()?.focus(e)}getBindingForFocus(){let e=this.formFieldBindings().filter(t=>t.focus!==void 0).reduce(Bt,void 0);return e||this.structure.children().map(t=>t.getBindingForFocus()).reduce(Bt,void 0)}pendingSync=K({source:()=>this.value(),computation:(e,t)=>{t?.value?.abort()}});get fieldTree(){return this.fieldProxy}get logicNode(){return this.structure.logic}get value(){return this.structure.value}get keyInParent(){return this.structure.keyInParent}get errors(){return this.validationState.errors}get parseErrors(){return this.validationState.parseErrors}get errorSummary(){return this.validationState.errorSummary}get pending(){return this.validationState.pending}get valid(){return this.validationState.valid}get invalid(){return this.validationState.invalid}get dirty(){return this.nodeState.dirty}get touched(){return this.nodeState.touched}get disabled(){return this.nodeState.disabled}get disabledReasons(){return this.nodeState.disabledReasons}get hidden(){return this.nodeState.hidden}get readonly(){return this.nodeState.readonly}get formFieldBindings(){return this.nodeState.formFieldBindings}get submitting(){return this.submitState.submitting}get name(){return this.nodeState.name}get max(){return this.metadata(qt)}get maxLength(){return this.metadata(Ht)}get min(){return this.metadata(zt)}get minLength(){return this.metadata($t)}get pattern(){return this.metadata(Xe)??Dn}get required(){return this.metadata(Ye)??Tn}metadata(e){return this.metadataState.get(e)}hasMetadata(e){return this.metadataState.has(e)}markAsTouched(){m(()=>{this.nodeState.markAsTouched(),this.flushSync()})}markAsDirty(){this.nodeState.markAsDirty()}markAsPristine(){this.nodeState.markAsPristine()}markAsUntouched(){this.nodeState.markAsUntouched()}reset(e){m(()=>this._reset(e))}_reset(e){e!==void 0&&this.value.set(e),this.nodeState.markAsUntouched(),this.nodeState.markAsPristine();for(let t of this.structure.children())t._reset()}controlValueSignal(){let e=K(this.value),{set:t,update:r}=e;return e.set=i=>{t(i),this.markAsDirty(),this.debounceSync()},e.update=i=>{r(i),this.markAsDirty(),this.debounceSync()},e}sync(){this.value.set(this.controlValue())}flushSync(){let e=this.pendingSync();e&&!e.signal.aborted&&(e.abort(),this.sync())}debounceSync(){return fe(this,null,function*(){let e=m(()=>(this.pendingSync()?.abort(),this.nodeState.debouncer()));if(e){let t=new AbortController,r=e(t.signal);if(r&&(this.pendingSync.set(t),yield r,t.signal.aborted))return}this.sync()})}static newRoot(e,t,r,i){return i.newRoot(e,t,r,i)}createStructure(e){return e.kind==="root"?new Ke(this,e.logic,e.fieldManager,e.value,this.newChild.bind(this)):new Ue(this,e.logic,e.parent,e.identityInParent,e.initialKeyInParent,this.newChild.bind(this))}newChild(e,t,r){let i,o;return r?(i=this.pathNode.getChild(U),o=this.structure.logic.getChild(U)):(i=this.pathNode.getChild(e),o=this.structure.logic.getChild(e)),this.fieldAdapter.newChild({kind:"child",parent:this,pathNode:i,logic:o,initialKeyInParent:e,identityInParent:t,fieldAdapter:this.fieldAdapter})}},Dn=d(()=>[]),Tn=d(()=>!1);function Bt(n,e){return n?e&&n.element.compareDocumentPosition(e.element)&Node.DOCUMENT_POSITION_PRECEDING?e:n:e}var qe=class{node;selfTouched=p(!1);selfDirty=p(!1);markAsTouched(){this.selfTouched.set(!0)}markAsDirty(){this.selfDirty.set(!0)}markAsPristine(){this.selfDirty.set(!1)}markAsUntouched(){this.selfTouched.set(!1)}formFieldBindings=p([]);constructor(e){this.node=e}dirty=d(()=>{let e=this.selfDirty()&&!this.isNonInteractive();return this.node.structure.reduceChildren(e,(t,r)=>r||t.nodeState.dirty(),Vt)});touched=d(()=>{let e=this.selfTouched()&&!this.isNonInteractive();return this.node.structure.reduceChildren(e,(t,r)=>r||t.nodeState.touched(),Vt)});disabledReasons=d(()=>[...this.node.structure.parent?.nodeState.disabledReasons()??[],...this.node.logicNode.logic.disabledReasons.compute(this.node.context)]);disabled=d(()=>!!this.disabledReasons().length);readonly=d(()=>(this.node.structure.parent?.nodeState.readonly()||this.node.logicNode.logic.readonly.compute(this.node.context))??!1);hidden=d(()=>(this.node.structure.parent?.nodeState.hidden()||this.node.logicNode.logic.hidden.compute(this.node.context))??!1);name=d(()=>{let e=this.node.structure.parent;return e?`${e.name()}.${this.node.structure.keyInParent()}`:this.node.structure.fieldManager.rootName});debouncer=d(()=>{if(this.node.logicNode.logic.hasMetadata(Le)){let t=this.node.logicNode.logic.getMetadata(Le).compute(this.node.context);if(t)return r=>t(this.node.context,r)}return this.node.structure.parent?.nodeState.debouncer?.()});isNonInteractive=d(()=>this.hidden()||this.disabled()||this.readonly())},$e=class{newRoot(e,t,r,i){return new ce({kind:"root",fieldManager:e,value:t,pathNode:r,logic:r.builder.build(),fieldAdapter:i})}newChild(e){return new ce(e)}createNodeState(e){return new qe(e)}createValidationState(e){return new Ve(e)}createStructure(e,t){return e.createStructure(t)}},He=class{injector;rootName;submitOptions;constructor(e,t,r){this.injector=e,this.rootName=t??`${this.injector.get(ut)}.form${xn++}`,this.submitOptions=r}structures=new Set;createFieldManagementEffect(e){I(()=>{let t=new Set;this.markStructuresLive(e,t);for(let r of this.structures)t.has(r)||(this.structures.delete(r),m(()=>r.destroy()))},{injector:this.injector})}markStructuresLive(e,t){t.add(e);for(let r of e.children())this.markStructuresLive(r.structure,t)}},xn=0;function In(n){let e,t,r;return n.length===3?[e,t,r]=n:n.length===2?bn(n[1])?[e,t]=n:[e,r]=n:[e]=n,[e,t,r]}function Je(...n){let[e,t,r]=In(n),i=r?.injector??u(L),o=re(i,()=>de.rootCompile(t)),s=new He(i,r?.name,r?.submission),a=r?.adapter??new $e,c=ce.newRoot(s,e,o,a);return s.createFieldManagementEffect(c.structure),c.fieldTree}function Fn(n,e){return fe(this,null,function*(){let t=m(n),r=e===void 0?t.structure.root.fieldProxy:n,i={root:t.structure.root.fieldProxy,submitted:n};e=typeof e=="function"?{action:e}:e??t.structure.fieldManager.submitOptions;let o=e?.action;if(!o)throw new b(1915,!1);let s=e?.onInvalid,a=e?.ignoreValidators??"pending",c=!0;m(()=>{Wt(t),a==="none"?c=t.valid():a==="pending"&&(c=!t.invalid())});try{if(c){t.submitState.selfSubmitting.set(!0);let f=yield m(()=>o?.(r,i));return f&&An(t,f),!f||E(f)&&f.length===0}else m(()=>s?.(r,i));return!1}finally{t.submitState.selfSubmitting.set(!1)}})}function Pn(n){return de.create(n)}function Wt(n){if(!n.validationState.shouldSkipValidation()){n.markAsTouched();for(let e of n.structure.children())Wt(e)}}function An(n,e){E(e)||(e=[e]);let t=new Map;for(let r of e){let i=Ze(r,n.fieldTree),o=i.fieldTree(),s=t.get(o);s||(s=[],t.set(o,s)),s.push(i)}for(let[r,i]of t)r.submitState.submissionErrors.set(i)}var Ge=class{kind="compat";control;fieldTree;context;message;constructor({context:e,kind:t,control:r}){this.context=e,this.kind=t,this.control=r}};function Yt(n){if(n.length===0)return null;let e={};for(let t of n)e[t.kind]=t instanceof Ge?t.context:t;return e}var On=new he("");function ke(n,e){return n instanceof Function?n(e):n}function Jt(n){return typeof n=="number"?isNaN(n):n===""||n===!1||n==null}function Xt(n){return n===void 0?[]:Array.isArray(n)?n:[n]}function Qt(n,e){We(n),A.unwrapFieldPath(n).builder.addSyncErrorRule(r=>Ze(e(r),r.fieldTree))}function Rn(n){return new Qe(n)}function Vn(n,e){return new et(n,e)}var ue=class{__brand=void 0;kind="";fieldTree;message;constructor(e){e&&Object.assign(this,e)}},Qe=class extends ue{kind="required"};var et=class extends ue{pattern;kind="pattern";constructor(e,t){super(t),this.pattern=e}};var tt=class extends ue{kind="parse"};function Pr(n,e,t){let r=le(n,x(),i=>e instanceof RegExp?e:e(i));le(n,Xe,({state:i})=>i.metadata(r)()),Qt(n,i=>{if(Jt(i.value()))return;let o=i.state.metadata(r)();if(o!==void 0&&!o.test(i.value()))return t?.error?ke(t.error,i):Vn(o,{message:ke(t?.message,i)})})}function en(n,e){let t=le(n,x(),r=>e?.when?e.when(r):!0);le(n,Ye,({state:r})=>r.metadata(t)()),Qt(n,r=>{if(r.state.metadata(t)()&&Jt(r.value()))return e?.error?ke(e.error,r):Rn({message:ke(e?.message,r)})})}var Ln=new he("");function jn(n,e,t){let r=K({source:n,computation:()=>[]}),i=o=>{let s=t(o);r.set(Xt(s.error)),s.value!==void 0&&e(s.value),r.set(Xt(s.error))};return{errors:r.asReadonly(),setRawValue:i}}var nt=class{field;constructor(e){this.field=e}control=this;get value(){return this.field().value()}get valid(){return this.field().valid()}get invalid(){return this.field().invalid()}get pending(){return this.field().pending()}get disabled(){return this.field().disabled()}get enabled(){return!this.field().disabled()}get errors(){return Yt(this.field().errors())}get pristine(){return!this.field().dirty()}get dirty(){return this.field().dirty()}get touched(){return this.field().touched()}get untouched(){return!this.field().touched()}get status(){if(this.field().disabled())return"DISABLED";if(this.field().valid())return"VALID";if(this.field().invalid())return"INVALID";if(this.field().pending())return"PENDING";throw new b(1910,!1)}valueAccessor=null;hasValidator(e){return e===It.required?this.field().required():!1}updateValueAndValidity(){}},rt={disabled:"disabled",disabledReasons:"disabledReasons",dirty:"dirty",errors:"errors",hidden:"hidden",invalid:"invalid",max:"max",maxLength:"maxLength",min:"min",minLength:"minLength",name:"name",pattern:"pattern",pending:"pending",readonly:"readonly",required:"required",touched:"touched"},Bn=(()=>{let n={};for(let e of Object.keys(rt))n[rt[e]]=e;return n})();function it(n,e){let t=Bn[e];return n[t]?.()}var ot=Object.values(rt);function Ee(){return{}}function z(n,e,t){return n[e]!==t?(n[e]=t,!0):!1}function Kn(n){return n.tagName==="INPUT"||n.tagName==="SELECT"||n.tagName==="TEXTAREA"}function Un(n){if(n.tagName!=="INPUT")return!1;let e=n.type;return e==="date"||e==="datetime-local"||e==="month"||e==="number"||e==="range"||e==="time"||e==="week"}function zn(n){return n.tagName==="INPUT"||n.tagName==="TEXTAREA"}function qn(n,e){let t;if(n.validity.badInput)return{error:new tt};switch(n.type){case"checkbox":return{value:n.checked};case"number":case"range":case"datetime-local":if(t=m(e),typeof t=="number"||t===null)return{value:n.value===""?null:n.valueAsNumber};break;case"date":case"month":case"time":case"week":if(t=m(e),t===null||t instanceof Date)return{value:n.valueAsDate};if(typeof t=="number")return{value:n.valueAsNumber};break}return{value:n.value}}function $n(n,e){switch(n.type){case"checkbox":n.checked=e;return;case"radio":n.checked=e===n.value;return;case"number":case"range":case"datetime-local":if(typeof e=="number"){Zt(n,e);return}else if(e===null){n.value="";return}break;case"date":case"month":case"time":case"week":if(e===null||e instanceof Date){n.valueAsDate=e;return}else if(typeof e=="number"){Zt(n,e);return}}n.value=e}function Zt(n,e){isNaN(e)?n.value="":n.valueAsNumber=e}function st(n,e,t,r){switch(t){case"name":n.setAttribute(e,t,r);break;case"disabled":case"readonly":case"required":r?n.setAttribute(e,t,""):n.removeAttribute(e,t);break;case"max":case"min":case"minLength":case"maxLength":r!==void 0?n.setAttribute(e,t,r.toString()):n.removeAttribute(e,t);break}}function Hn(n,e){n.listenToCustomControlModel(r=>e.state().controlValue.set(r)),n.listenToCustomControlOutput("touchedChange",()=>e.state().markAsTouched()),e.registerAsBinding(n.customControl);let t=Ee();return()=>{let r=e.state(),i=r.controlValue();z(t,"controlValue",i)&&n.setCustomControlModelInput(i);for(let o of ot){let s;o==="errors"?s=e.errors():s=it(r,o),z(t,o,s)&&(n.setInputOnDirectives(o,s),e.elementAcceptsNativeProperty(o)&&!n.customControlHasInput(o)&&st(e.renderer,e.nativeFormElement,o,s))}}}function Gn(n,e){e.controlValueAccessor.registerOnChange(r=>e.state().controlValue.set(r)),e.controlValueAccessor.registerOnTouched(()=>e.state().markAsTouched()),e.registerAsBinding();let t=Ee();return()=>{let r=e.state(),i=r.value();z(t,"controlValue",i)&&m(()=>e.controlValueAccessor.writeValue(i));for(let o of ot){let s=it(r,o);if(z(t,o,s)){let a=n.setInputOnDirectives(o,s);o==="disabled"&&e.controlValueAccessor.setDisabledState?m(()=>e.controlValueAccessor.setDisabledState(s)):!a&&e.elementAcceptsNativeProperty(o)&&st(e.renderer,e.nativeFormElement,o,s)}}}}function Wn(n,e,t){if(typeof MutationObserver!="function")return;let r=new MutationObserver(i=>{i.some(o=>Yn(o))&&e()});r.observe(n,{attributes:!0,attributeFilter:["value"],characterData:!0,childList:!0,subtree:!0}),t.onDestroy(()=>r.disconnect())}function Yn(n){if(n.type==="childList"||n.type==="characterData"){if(n.target instanceof Comment)return!1;for(let e of n.addedNodes)if(!(e instanceof Comment))return!0;for(let e of n.removedNodes)if(!(e instanceof Comment))return!0;return!1}return n.type==="attributes"&&n.target instanceof HTMLOptionElement}function Xn(n,e,t){let r=!1,i=e.nativeFormElement,o=jn(()=>e.state().value(),a=>e.state().controlValue.set(a),()=>qn(i,e.state().value));t.set(o.errors),n.listenToDom("input",()=>o.setRawValue(void 0)),n.listenToDom("blur",()=>e.state().markAsTouched()),e.registerAsBinding(),i.tagName==="SELECT"&&Wn(i,()=>{r&&(i.value=e.state().controlValue())},e.destroyRef);let s=Ee();return()=>{let a=e.state(),c=a.controlValue();z(s,"controlValue",c)&&$n(i,c);for(let f of ot){let N=it(a,f);z(s,f,N)&&(n.setInputOnDirectives(f,N),e.elementAcceptsNativeProperty(f)&&st(e.renderer,i,f,N))}r=!0}}var Zn=Symbol(),Jn=new he(""),Ar=(()=>{class n{field=h.required({alias:"formField"});renderer=u(mt);destroyRef=u(ct);state=d(()=>this.field()());injector=u(L);element=u(lt).nativeElement;elementIsNativeFormElement=Kn(this.element);elementAcceptsNumericValues=Un(this.element);elementAcceptsTextualValues=zn(this.element);nativeFormElement=this.elementIsNativeFormElement?this.element:void 0;focuser=t=>this.element.focus(t);controlValueAccessors=u(xt,{optional:!0,self:!0});config=u(On,{optional:!0});parseErrorsSource=p(void 0);_interopNgControl;get interopNgControl(){return this._interopNgControl??=new nt(this.state)}parseErrors=d(()=>this.parseErrorsSource()?.().map(t=>_(l({},t),{fieldTree:m(this.state).fieldTree,formField:this}))??[]);errors=d(()=>this.state().errors().filter(t=>!t.formField||t.formField===this));isFieldBinding=!1;get controlValueAccessor(){return this.controlValueAccessors?.[0]??this.interopNgControl?.valueAccessor??void 0}installClassBindingEffect(){let t=Object.entries(this.config?.classes??{}).map(([i,o])=>[i,d(()=>o(this))]);if(t.length===0)return;let r=Ee();Dt({write:()=>{for(let[i,o]of t){let s=o();z(r,i,s)&&(s?this.renderer.addClass(this.element,i):this.renderer.removeClass(this.element,i))}}},{injector:this.injector})}focus(t){this.focuser(t)}registerAsBinding(t){if(this.isFieldBinding)throw new b(1913,!1);this.isFieldBinding=!0,this.installClassBindingEffect(),t?.focus&&(this.focuser=r=>t.focus(r)),I(r=>{let i=this.state();i.nodeState.formFieldBindings.update(o=>[...o,this]),r(()=>{i.nodeState.formFieldBindings.update(o=>o.filter(s=>s!==this))})},{injector:this.injector})}[Zn];\u0275ngControlCreate(t){if(!t.hasPassThrough)if(this.controlValueAccessor)this.\u0275ngControlUpdate=Gn(t,this);else if(t.customControl)this.\u0275ngControlUpdate=Hn(t,this);else if(this.elementIsNativeFormElement)this.\u0275ngControlUpdate=Xn(t,this,this.parseErrorsSource);else throw new b(1914,!1)}\u0275ngControlUpdate;elementAcceptsNativeProperty(t){if(!this.elementIsNativeFormElement)return!1;switch(t){case"min":case"max":return this.elementAcceptsNumericValues;case"minLength":case"maxLength":return this.elementAcceptsTextualValues;case"disabled":case"required":case"readonly":case"name":return!0;default:return!1}}static \u0275fac=function(r){return new(r||n)};static \u0275dir=ft({type:n,selectors:[["","formField",""]],inputs:{field:[1,"formField","field"]},exportAs:["formField"],features:[St([{provide:Jn,useExisting:n},{provide:Ft,useFactory:()=>u(n).interopNgControl},{provide:Ln,useFactory:()=>u(n).parseErrorsSource}]),ht("formField")]})}return n})();var me={roles:[],production:!0,appId:"appId",url:"https://api.webart.work",sign:{logo:"",email:"",password:""},image:{default:"https://ngx.webart.work/assets/logo.png",logo:"https://ngx.webart.work/assets/logo.png"},meta:{title:"Web Art Work",description:"An amazing solution to build web or mobile app for your business",favicon:"https://ngx.webart.work/assets/favicon.ico",image:"https://ngx.webart.work/assets/logo.png"},defaultLanguageCode:"en",languages:[{name:"Ukrainian",origin:"\u0443\u043A\u0440\u0430\u0457\u043D\u0441\u044C\u043A\u0430",code:"uk"},{code:"en",name:"English",origin:"English"}]};var te={type:"primary",extraClass:"",disabled:!1,disableSubmit:!1,isMultipleClicksAllowed:!1},tn="",at={primary:"wbutton--primary",secondary:"wbutton--secondary",success:"wbutton--success",danger:"wbutton--danger",warning:"wbutton--warning",info:"wbutton--info",light:"wbutton--light",dark:"wbutton--dark",link:"wbutton--link"};var Qn=["*"],nn=(()=>{class n{constructor(){this._cdr=u(Et),this.type=h(te.type),this.extraClass=h(te.extraClass),this.disabled=h(te.disabled),this.disableSubmit=h(te.disableSubmit),this.isMultipleClicksAllowed=h(te.isMultipleClicksAllowed),this.wClick=P(),this.baseClasses=tn,this._cooling=!1}get isBlocked(){return this.disabled()||!this.isMultipleClicksAllowed()&&this._cooling}typeClass(){return at[this.type()]??at.primary}clicked(t){if(this.isBlocked){t.preventDefault(),t.stopImmediatePropagation();return}this.wClick.emit(t),this.isMultipleClicksAllowed()||(this._cooling=!0,this._cdr.markForCheck(),setTimeout(()=>{this._cooling=!1,this._cdr.markForCheck()},2e3))}resolveType(){return this.disableSubmit()?"button":"submit"}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=S({type:n,selectors:[["wbutton"]],inputs:{type:[1,"type"],extraClass:[1,"extraClass"],disabled:[1,"disabled"],disableSubmit:[1,"disableSubmit"],isMultipleClicksAllowed:[1,"isMultipleClicksAllowed"]},outputs:{wClick:"wClick"},ngContentSelectors:Qn,decls:2,vars:4,consts:[[3,"click","type","disabled"]],template:function(r,i){r&1&&(vt(),G(0,"button",0),W("click",function(s){return i.clicked(s)}),_t(1),ie()),r&2&&(T("wbutton "+i.baseClasses+" "+i.typeClass()+" "+(i.extraClass()||"")),yt("type",i.resolveType())("disabled",i.isBlocked))},styles:["[_nghost-%COMP%]{display:inline-flex;align-items:stretch}.wbutton[_ngcontent-%COMP%]{cursor:pointer;display:inline-flex;align-items:center;justify-content:center;gap:var(--sp-2);-webkit-user-select:none;user-select:none;white-space:nowrap;border-radius:var(--radius-btn);font-family:var(--ff-base);letter-spacing:var(--letter-spacing);font-weight:500;font-size:.875rem;line-height:1;padding:var(--sp-3) var(--sp-6);border:1px solid transparent;transition:background-color var(--motion) var(--easing),color var(--motion) var(--easing),border-color var(--motion) var(--easing),box-shadow var(--motion-fast) var(--easing),transform var(--motion-fast) var(--easing)}.wbutton[_ngcontent-%COMP%]:focus-visible{outline:none;box-shadow:var(--focus-ring)}.wbutton[_ngcontent-%COMP%]:disabled, .wbutton[aria-disabled=true][_ngcontent-%COMP%]{opacity:.6;cursor:not-allowed;pointer-events:none}.wbutton--primary[_ngcontent-%COMP%]{background:var(--c-primary);color:var(--c-text-secondary)}.wbutton--primary[_ngcontent-%COMP%]:hover{background:var(--c-primary-hover)}.wbutton--secondary[_ngcontent-%COMP%]{background:var(--c-secondary);color:var(--c-text-secondary)}.wbutton--secondary[_ngcontent-%COMP%]:hover{background:var(--c-secondary-hover)}.wbutton--success[_ngcontent-%COMP%]{background:var(--c-primary);color:var(--c-text-secondary)}.wbutton--success[_ngcontent-%COMP%]:hover{background:var(--c-primary-hover)}.wbutton--danger[_ngcontent-%COMP%]{background:var(--c-secondary);color:var(--c-text-secondary)}.wbutton--danger[_ngcontent-%COMP%]:hover{background:var(--c-secondary-hover)}.wbutton--warning[_ngcontent-%COMP%], .wbutton--info[_ngcontent-%COMP%]{background:var(--c-bg-tertiary);color:var(--c-text-secondary);border-color:var(--c-border)}.wbutton--warning[_ngcontent-%COMP%]:hover, .wbutton--info[_ngcontent-%COMP%]:hover{background:var(--c-bg-secondary)}.wbutton--light[_ngcontent-%COMP%]{background:var(--c-bg-secondary);color:var(--c-text-secondary);border-color:var(--c-border)}.wbutton--light[_ngcontent-%COMP%]:hover{background:var(--c-bg-tertiary)}.wbutton--dark[_ngcontent-%COMP%]{background:var(--c-text-secondary);color:var(--c-bg-secondary)}.wbutton--dark[_ngcontent-%COMP%]:hover{filter:brightness(.95)}.wbutton--link[_ngcontent-%COMP%]{background:transparent;color:var(--c-text-secondary);padding:0;border-color:transparent;border-radius:0}.wbutton--link[_ngcontent-%COMP%]:hover{text-decoration:underline}"],changeDetection:0})}}return n})();var rn=(()=>{class n extends ye{constructor(){super({name:"formcomponent"}),this.components=p([]),this.get({query:"appId="+me.appId}),this.loaded.subscribe(()=>{this.components.set(this.getDocs())})}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=q({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var er=()=>[],on=()=>({}),tr=(n,e,t,r,i,o,s,a,c,f,N,un,mn)=>({props:n,config:e,component:t,wFormId:r,wFormKey:i,wSubmit:o,wChange:s,wClick:a,model:c,fieldTree:f,field:N,submition:un,key:mn}),nr=n=>({$implicit:n}),rr=(n,e)=>e.key??n;function ir(n,e){if(n&1){let t=F();v(0,"form-component",3),k("wSubmit",function(){C(t);let i=g(3);return M(i.wSubmit.emit(i.submition()||{}))})("wChange",function(){C(t);let i=g(3);return M(i.wChange.emit())})("wClick",function(){C(t);let i=g(3);return M(i.wClick.emit())}),w()}if(n&2){let t=g(),r=t.$implicit,i=t.$index,o=g(2);T(ge("wformc__item ",o.formId()," ",o.formId()+"_"+o.index()+"_"+i," ",r.class||"")),D("formId",o.formId())("component",r)("config",o.config())("submition",o.submition())("model",o.model())("fieldTree",o.fieldTree())("index",o.index()+"_"+i)}}function or(n,e){if(n&1&&j(0,ir,1,12,"form-component",2),n&2){let t=e.$implicit;B(t.hidden?-1:0)}}function sr(n,e){if(n&1&&(v(0,"div"),$(1,or,1,1,null,null,rr),w()),n&2){let t=g();T(pe("wformc ",t.component().class||"")),y(),H(t.component().components??X(3,er))}}function ar(n,e){if(n&1&&(v(0,"div",1),bt(1,4),w()),n&2){let t=g();y(),D("ngTemplateOutlet",t.template())("ngTemplateOutletContext",Nt(18,nr,kt(4,tr,[t.component().props||X(2,on),t.config(),t.component(),t.formId(),t.effectiveKey(),t.submit.bind(t),t.change.bind(t),t.click.bind(t),t.model(),t.fieldTree(),t.field,t.submition()||X(3,on),t.effectiveKey()])))}}var sn=(()=>{class n{constructor(){this._form=u(ne),this.index=h(""),this.formId=h(""),this.config=h.required(),this.component=h.required(),this.submition=h({}),this.model=h(null),this.fieldTree=h(null),this.wSubmit=P(),this.wChange=P(),this.wClick=P(),this.template=p(null),I(()=>{this._form.templatesVersion();let t=this.component().name;this.template.set(t?this._form.getTemplateComponent(t):null)})}hasChildren(){return Array.isArray(this.component().components)&&!!this.component().components?.length}effectiveKey(){let t=this.component().key;if(!t)return null;if(!t.includes("[]"))return t;let r=(this.index()||"").split("_").pop()||"0",i=Number.isFinite(+r)?+r:0;return t.replace(/\[\]/g,`[${i}]`)}get field(){let t=this.fieldTree(),r=this.effectiveKey();return!t||!r?null:t[r]}submit(){this.wSubmit.emit(this.submition()||{})}change(){this.wChange.emit()}click(){this.wClick.emit()}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=S({type:n,selectors:[["form-component"]],inputs:{index:[1,"index"],formId:[1,"formId"],config:[1,"config"],component:[1,"component"],submition:[1,"submition"],model:[1,"model"],fieldTree:[1,"fieldTree"]},outputs:{wSubmit:"wSubmit",wChange:"wChange",wClick:"wClick"},decls:2,vars:1,consts:[[3,"class"],[1,"wformc"],[3,"class","formId","component","config","submition","model","fieldTree","index"],[3,"wSubmit","wChange","wClick","formId","component","config","submition","model","fieldTree","index"],[3,"ngTemplateOutlet","ngTemplateOutletContext"]],template:function(r,i){r&1&&j(0,sr,3,4,"div",0)(1,ar,2,20,"div",1),r&2&&B(i.hasChildren()?0:i.component().name&&i.template()?1:-1)},dependencies:[n,Tt],styles:["[_nghost-%COMP%]{display:block;position:relative}.wformc[_ngcontent-%COMP%]{position:relative;padding:0}.wformc__item[_ngcontent-%COMP%]{display:block;margin:0 0 10px}"],changeDetection:0})}}return n})();var dr=()=>({}),cr=(n,e)=>e.key??n;function lr(n,e){if(n&1&&(v(0,"h1",0),Y(1),w()),n&2){let t=g();y(),wt(t.title)}}function ur(n,e){if(n&1){let t=F();v(0,"form-component",3),k("wSubmit",function(){C(t);let i=g();return M(i.onSubmit())})("wChange",function(){C(t);let i=g();return M(i.onLegacyChange())})("wClick",function(){C(t);let i=g();return M(i.onClick())}),w()}if(n&2){let t=e.$implicit,r=e.$index,i=g(),o=Ie(0),s=Ie(1);T(ge("wform__component ",i.formId," ",i.formId+"_"+r," ",t.class||"")),D("formId",i.formId)("component",t)("config",o)("submition",s)("model",i.model)("fieldTree",i.fieldTree)("index",""+r)}}var De=(()=>{class n{constructor(){this._coreService=u(be),this._formService=u(ne),this._formcomponentService=u(rn),this.config=h.required(),this.submition=h({}),this.wChange=P(),this.wSubmit=P(),this._components=d(()=>this.config()?.components??[]),this.visibleComponents=d(()=>this._components().filter(t=>!t?.hidden).concat(this._formcomponentService.components().filter(t=>t.formId===this.formId))),this.instance=p(null),I(()=>{let t=this.config(),r=this.submition();if(!t)return;let i=m(()=>this._formService.form(t,r??void 0));this.instance.set(i)}),I(()=>{let t=this.instance();if(!t)return;let r=t.model();this.wChange.emit(r)})}get formId(){return this.instance()?.id??""}get fieldTree(){return this.instance()?.form??null}get model(){return this.instance()?.model??null}get title(){return this.config()?.title}get cssClass(){return this.config()?.class??""}onSubmit(){let t=this.instance(),r=t?t.model():{};this.wSubmit.emit(r)}onLegacyChange(){let t=this.instance(),r=t?t.model():{};console.log(this.submition,r),this._coreService.afterWhile(this,()=>this.wChange.emit(r),150)}onClick(){}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=S({type:n,selectors:[["wform"]],inputs:{config:[1,"config"],submition:[1,"submition"]},outputs:{wChange:"wChange",wSubmit:"wSubmit"},decls:7,vars:7,consts:[[1,"wform__title"],[1,"wform__body",3,"submit"],[3,"class","formId","component","config","submition","model","fieldTree","index"],[3,"wSubmit","wChange","wClick","formId","component","config","submition","model","fieldTree","index"]],template:function(r,i){if(r&1){let o=F();Mt(0)(1),v(2,"div"),j(3,lr,2,1,"h1",0),v(4,"form",1),k("submit",function(a){return C(o),a.preventDefault(),M(i.onSubmit())}),$(5,ur,1,12,"form-component",2,cr),w()()}if(r&2){xe(i.config());let o=i.submition();y(),xe(o||X(6,dr)),y(),T(pe("wform ",i.cssClass)),y(),B(i.title?3:-1),y(2),H(i.visibleComponents())}},dependencies:[sn],styles:[".wform[_ngcontent-%COMP%]{display:grid;gap:var(--sp-3)}.wform__title[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:700;color:var(--c-text-secondary)}.wform__subtitle[_ngcontent-%COMP%]{font-size:.9rem;color:var(--c-text-muted)}.wform__grid[_ngcontent-%COMP%]{display:grid;gap:var(--sp-3)}.wform__row[_ngcontent-%COMP%]{display:grid;gap:var(--sp-3);grid-template-columns:repeat(12,minmax(0,1fr))}.wform__cell[_ngcontent-%COMP%]{grid-column:span 12}.wform__cell._span-1[_ngcontent-%COMP%]{grid-column:span 1}.wform__cell._span-2[_ngcontent-%COMP%]{grid-column:span 2}.wform__cell._span-3[_ngcontent-%COMP%]{grid-column:span 3}.wform__cell._span-4[_ngcontent-%COMP%]{grid-column:span 4}.wform__cell._span-5[_ngcontent-%COMP%]{grid-column:span 5}.wform__cell._span-6[_ngcontent-%COMP%]{grid-column:span 6}.wform__cell._span-7[_ngcontent-%COMP%]{grid-column:span 7}.wform__cell._span-8[_ngcontent-%COMP%]{grid-column:span 8}.wform__cell._span-9[_ngcontent-%COMP%]{grid-column:span 9}.wform__cell._span-10[_ngcontent-%COMP%]{grid-column:span 10}.wform__cell._span-11[_ngcontent-%COMP%]{grid-column:span 11}.wform__cell._span-12[_ngcontent-%COMP%]{grid-column:span 12}.wform__actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:var(--sp-2);margin-top:var(--sp-2)}.wform__card[_ngcontent-%COMP%]{border:1px solid var(--c-border);border-radius:var(--radius);background:var(--c-bg-secondary);box-shadow:var(--shadow-sm);padding:var(--sp-4)}"],changeDetection:0})}}return n})();function mr(n,e){if(n&1){let t=F();v(0,"wbutton",6),k("wClick",function(){let i=C(t).$implicit,o=g();return M(o.onButtonClick(i))}),Y(1),w()}if(n&2){let t=e.$implicit,r=g();D("extraClass","w-btn "+(t.class||""))("disabled",r.submitting()),y(),Ct(" ",t.label," ")}}var dt=(()=>{class n{constructor(){this._coreService=u(be),this._formService=u(ne),this.submit=t=>{},this.change=t=>{},this.submitting=p(!1),this.resetOnSubmit=!1}_sync(t){if(!t)return;this._coreService.copy(t,this.submition);let r=t.data;r&&typeof r=="object"&&(this.submition.data=this.submition.data||{},this._coreService.copy(r,this.submition.data))}handleSubmit(t){this.submitting.set(!0);try{this._sync(t),this.submit(this.submition),this.close()}finally{this.submitting.set(!1),this.resetOnSubmit&&this.form.formId&&this._formService.reset(this.form.formId)}}handleChange(t){this._sync(t),this.change(this.submition)}onButtonClick(t){this.submitting()||(t.click(this.submition,this.close),this.resetOnSubmit&&this.form.formId&&this._formService.reset(this.form.formId))}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=S({type:n,selectors:[["ng-component"]],decls:7,vars:2,consts:[["formRef",""],[1,"modal-form"],[1,"modal-form__body"],[3,"wSubmit","wChange","submition","config"],[1,"modal-form__actions"],["type","primary",3,"extraClass","disabled"],["type","primary",3,"wClick","extraClass","disabled"]],template:function(r,i){r&1&&(v(0,"div",1)(1,"div",2)(2,"wform",3,0),k("wSubmit",function(s){return i.handleSubmit(s)})("wChange",function(s){return i.handleChange(s)}),w()(),v(4,"div",4),$(5,mr,2,3,"wbutton",5,pt),w()()),r&2&&(y(2),D("submition",i.submition)("config",i.form),y(3),H(i.modalButtons))},dependencies:[De,nn],styles:["[_nghost-%COMP%]{display:block;max-block-size:100%}.modal-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;min-block-size:100%}.modal-form__body[_ngcontent-%COMP%]{flex:1 1 auto;min-block-size:0;margin-top:var(--sp-3)}.modal-form__actions[_ngcontent-%COMP%]{position:sticky;inset-block-end:calc(-1 * var(--sp-4));padding-block-start:var(--sp-3);padding-block-end:var(--sp-3);background:var(--c-bg-secondary)}.modal-form__actions[_ngcontent-%COMP%]   .w-btn[_ngcontent-%COMP%]{width:100%;display:block}"],changeDetection:0})}}return n})();var an=(()=>{class n{constructor(){this._http=u(At),this.form=h.required(),this.module=h.required(),this.field=h.required(),this.doc=h.required()}get getDoc(){return this.doc()}change(t){this._http.post(`/api/${this.module()}/unique${this.field()||""}`,this.doc()).subscribe(r=>{this.doc()[this.field()]!==r&&(this.doc()[this.field()]=r)})}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=S({type:n,selectors:[["ng-component"]],inputs:{form:[1,"form"],module:[1,"module"],field:[1,"field"],doc:[1,"doc"]},decls:1,vars:2,consts:[[3,"wChange","config","submition"]],template:function(r,i){r&1&&(v(0,"wform",0),k("wChange",function(s){return i.change(s)}),w()),r&2&&D("config",i.form())("submition",i.getDoc)},dependencies:[De],encapsulation:2,changeDetection:0})}}return n})();function fr(n,e){if(n&1){let t=F();G(0,"button",4),W("wClick",function(){C(t);let i=g();return M(i.close())}),Y(1," close "),ie()}}var dn=(()=>{class n{constructor(){this.closable=!0,this.close=()=>{},this.size="mid",this.panelClass="",this._popStateHandler=t=>this.popStateListener(t)}ngOnInit(){typeof this.onClickOutside!="function"&&(this.onClickOutside=this.close),typeof this.onOpen=="function"&&this.onOpen(),window.addEventListener("popstate",this._popStateHandler)}ngOnDestroy(){window.removeEventListener("popstate",this._popStateHandler)}onBackdropClick(){this.onClickOutside?.()}popStateListener(t){this.close?.()}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=S({type:n,selectors:[["lib-modal"]],decls:4,vars:3,consts:[[1,"wacom-modal","fixed","inset-0","z-[9999]","flex","items-center","justify-center","p-6","md:p-10","bg-black/55",3,"click"],[1,"wacom-modal__content","relative","flex","flex-col","w-full","max-h-[90vh]","overflow-hidden","shadow-[0_18px_45px_rgba(0,0,0,0.6)]",3,"click"],[1,"wacom-modal__body","flex-1","min-h-0","overflow-auto","p-4","md:p-6","pr-14"],["wbutton","","type","button","aria-label","Close",1,"wacom-modal__close","material-icons","absolute","top-3","right-3","inline-flex","!h-10","!w-10","items-center","justify-center","!rounded-full","!p-0","text-[var(--c-text-secondary)]","hover:bg-white/10","focus-visible:outline-none"],["wbutton","","type","button","aria-label","Close",1,"wacom-modal__close","material-icons","absolute","top-3","right-3","inline-flex","!h-10","!w-10","items-center","justify-center","!rounded-full","!p-0","text-[var(--c-text-secondary)]","hover:bg-white/10","focus-visible:outline-none",3,"wClick"]],template:function(r,i){r&1&&(G(0,"div",0),W("click",function(){return i.onBackdropClick()}),G(1,"div",1),W("click",function(s){return s.stopPropagation()}),gt(2,"div",2),j(3,fr,2,0,"button",3),ie()()),r&2&&(y(),T("bg-[var(--c-bg-secondary)] text-[var(--c-text-primary)] rounded-[var(--radius-card)] "+(i.panelClass||"")+" "+(i.size==="small"?"max-w-md":"")+(!i.size||i.size==="mid"?" max-w-4xl":"")+(i.size==="big"?" max-w-6xl":"")+(i.size==="full"?" max-w-[1440px] max-h-[calc(100vh-3rem)] md:max-h-[calc(100vh-5rem)]":"")),y(2),B(i.closable?3:-1))},styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0})}}return n})();var cn={size:"mid",timeout:0,class:"",panelClass:"",closable:!0};var ln=(()=>{class n{constructor(){this._dom=u(Rt),this._modals=[],this._config=l({},cn)}show(t){let r=this._withConfig(t);if(r.unique&&this._modals.find(a=>a.unique===r.unique))return this._modals.find(a=>a.unique===r.unique);this._modals.push(r),r.class||="",r.panelClass||=r.class||"",r.id||=Math.floor(Math.random()*Date.now())+Date.now(),document.body.classList.add("modalOpened");let i,o;r.close=()=>{o?.remove(),o=void 0,i?.remove(),i=void 0,typeof r.onClose=="function"&&r.onClose(),this._modals=this._modals.filter(a=>a.id!==r.id),this._modals.length||document.body.classList.remove("modalOpened")},typeof r.timeout=="number"&&r.timeout>0&&setTimeout(()=>r.close?.(),r.timeout),i=this._dom.appendComponent(dn,r);let s=i.nativeElement.children[0].children[0].children[0];return o=this._dom.appendComponent(r.component,r,s),r}open(t){this.show(t)}small(t){this.show(_(l({},t),{size:"small"}))}mid(t){this.show(_(l({},t),{size:"mid"}))}big(t){this.show(_(l({},t),{size:"big"}))}full(t){this.show(_(l({},t),{size:"full"}))}destroy(){for(let t=this._modals.length-1;t>=0;t--)this._modals[t].close?.()}setConfig(t){this._config=l(l({},this._config),t)}_withConfig(t){let i=typeof t=="function"?_(l({},this._config),{component:t}):_(l(l({},this._config),t),{component:t.component});return!i.panelClass&&i.class&&(i.panelClass=i.class),i}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=q({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var ne=(()=>{class n extends ye{constructor(){super({name:"form"}),this._modalService=u(ln),this._storeService=u(Ot),this._injector=u(L),this.appId=me.appId,this._templateComponent=new Map,this.templatesVersion=p(0),this.templateFields={},this.customTemplateFields={},this.forms=[],this.formIds=p([]),this._signalForms=new Map,this._storeService.getJson("formIds",{onSuccess:t=>{Array.isArray(t)&&this.formIds.set(t)}}),this.get({query:"appId="+me.appId})}addTemplateComponent(t,r){this._templateComponent.has(t)||(this._templateComponent.set(t,r),this.templatesVersion.update(i=>i+1))}removeTemplateComponent(t){this._templateComponent.delete(t)&&this.templatesVersion.update(r=>r+1)}getTemplateComponent(t){return this._templateComponent.get(t)??null}getTemplateComponentsNames(){return Array.from(this._templateComponent.keys())}getTemplateFields(t){return this.templateFields[t]||["Placeholder","Label"]}setTemplateFields(t,r,i={}){this.templateFields[t]=r,this.customTemplateFields[t]=l(l({},this.customTemplateFields[t]||{}),i)}getCustomTemplateFields(t){return this.customTemplateFields[t]||{}}getDefaultForm(t,r=["name","description"]){this._rememberFormId(t);let i=r.map((o,s)=>{let a=o.includes(".")?o.split(".")[1]:"Text",c=(o.split(".")[0]||o).replace(/\[\]|\[\d+\]/g,"");return{name:a,key:o,focused:s===0,props:{placeholder:`Enter your ${c}`,label:c.charAt(0).toUpperCase()+c.slice(1)}}});return{formId:t,components:i}}form(t,r){t.formId&&this._rememberFormId(t.formId);let i=t.formId||crypto.randomUUID();t.formId=i;let o=this._signalForms.get(i);if(o)return r&&Object.keys(r).length&&o.model.set(this._buildInitialModel(t,l(l({},o.model()??{}),r??{}))),o;let s=this._buildInitialModel(t,r??{}),a=p(s),c=re(this._injector,()=>Je(a,N=>{this._applyValidators(N,t)})),f={id:i,model:a,form:c,schema:t};return this._signalForms.set(i,f),f}_buildInitialModel(t,r={}){let i=l({},r);return this._traverseComponents(t.components,o=>{o.key&&(o.key in i||(i[o.key]=null))}),i}_applyValidators(t,r){this._traverseComponents(r.components,i=>{if(!i.key)return;let o=t[i.key];if(!o)return;let s=i.props?.label??i.key;i.required&&en(o,{message:`${s} is required`})})}_traverseComponents(t,r){if(t?.length)for(let i of t)r(i),i.components?.length&&this._traverseComponents(i.components,r)}modal(t,r=[],i={data:{}},o=a=>{},s={}){return(Array.isArray(t)?t:[t]).forEach(c=>this.form(c,i)),new Promise(c=>{this._modalService.show(_(l({},s),{component:dt,class:"forms_modalService",size:"big",form:t,modalButtons:Array.isArray(r)?r:[r],submition:i,onClose:()=>c(i),submit:f=>c(f),change:f=>{typeof o=="function"&&o(f)}}))})}modalDocs(t,r="Modify content of documents"){return new Promise(i=>{let o={docs:JSON.stringify(t.length?t:[],null,4)};this._modalService.show({component:dt,class:"forms_modalService",size:"big",submition:o,form:{title:r,components:[{name:"Ace",key:"docs",props:{placeholder:"Fill content of documents..."}}]},modalButtons:[{label:"Update",click:(s,a)=>{a();let c=o.docs?JSON.parse(o.docs):[];i(c)}}]})})}modalUnique(t,r,i,o="",s=()=>{}){let a=this.getDefaultForm("unique",[r+(o?"."+o:"")]);this.form(a,i),this._modalService.show({component:an,form:a,module:t,field:r,doc:i,class:"forms_modalService",onClose:s})}getComponent(t,r){return this._getComponent(t.components,r)||{}}getProp(t,r,i){return this.getComponent(t,r)?.props?.[i]??null}setProp(t,r,i,o){let s=this.getComponent(t,r);s&&(s.props=s.props||{},s.props[i]=o)}_getComponent(t=[],r){for(let i of t||[]){if(i.key===r)return i;if(i.components?.length){let o=this._getComponent(i.components,r);if(o)return o}}return null}_rememberFormId(t){t&&(this.formIds().includes(t)||(this.formIds.update(r=>(r.push(t),r)),this._storeService.setJson("formIds",this.formIds())))}reset(t,r={}){let i=this._signalForms.get(t);i&&i.model.set(this._buildInitialModel(i.schema,r))}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=q({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();export{Je as a,Fn as b,Pn as c,Pr as d,en as e,Ar as f,me as g,te as h,nn as i,rn as j,ln as k,ne as l};
